// Investor OS - Knowledge Graph Schema
// Operating system for Red Beard Ventures and Denarii Labs

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

// ============================================================================
// INVESTOR OS BRAIN - Knowledge Graph Models
// ============================================================================

// Privacy Tiers for data access control
enum PrivacyTier {
  PUBLIC            // Shareable publicly
  INTERNAL          // Internal team only
  SENSITIVE         // Need-to-know basis
  HIGHLY_SENSITIVE  // Highly restricted (financials, terms)
}

// Organization types in the knowledge graph
enum OrganizationType {
  PORTFOLIO         // Current portfolio company
  PROSPECT          // Potential investment
  LP                // Limited Partner
  FUND              // Other funds
  SERVICE_PROVIDER  // Lawyers, accountants, market makers, etc.
  OTHER
}

// Deal pipeline stages
enum DealStage {
  SOURCED           // Initial contact
  FIRST_CALL        // First conversation scheduled/done
  DILIGENCE         // Active diligence
  PARTNER_REVIEW    // Internal review
  TERM_SHEET        // Term sheet stage
  CLOSING           // Legal/closing
  PASSED            // Decided not to invest
  PORTFOLIO         // Closed, now in portfolio
}

// Deal instrument types
enum DealType {
  EQUITY
  SAFE
  CONVERTIBLE
  TOKEN
  OTHER
}

// Investment status
enum InvestmentStatus {
  ACTIVE
  EXITED
  WRITTEN_OFF
}

// Conversation medium
enum ConversationMedium {
  MEETING
  EMAIL
  CALL
  SLACK
  WHATSAPP
  OTHER
}

// Task status
enum TaskStatus {
  OPEN
  IN_PROGRESS
  DONE
  CANCELLED
}

// Task priority
enum Priority {
  LOW
  MEDIUM
  HIGH
  URGENT
}

// PEOPLE - Unified person tracking
model Person {
  id              String   @id @default(cuid())
  canonicalKey    String   @unique // email or normalized name for deduplication

  // Core attributes
  firstName       String
  lastName        String
  fullName        String
  email           String?  @unique
  linkedInUrl     String?
  twitterHandle   String?
  phone           String?

  // Geography
  city            String?
  country         String?
  region          String?   // e.g., "EMEA", "APAC", "North America"

  // Contact methods
  telegramHandle  String?

  // Ownership tracking
  addedBy         String?   // Person ID of team member who added this
  currentOwner    String?   // Person ID of team member who owns relationship
  primaryPOC      String?   // Person ID of primary point of contact

  // Privacy tier
  privacyTier     PrivacyTier @default(INTERNAL)

  // Metadata
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  lastContactedAt DateTime?

  // Relationships (use Relationship model for graph edges)
  // Query via: Relationship.where({ sourceType: "Person", sourceId: person.id })
  //        or: Relationship.where({ targetType: "Person", targetId: person.id })
  conversations   Conversation[] @relation("ConversationParticipants")
  tasks           Task[]
  facts           Fact[]
  lpCommitments   LPCommitment[]

  @@index([email])
  @@index([canonicalKey])
  @@index([privacyTier])
  @@index([city])
  @@index([country])
  @@index([region])
  @@index([telegramHandle])
  @@index([currentOwner])
}

// ORGANIZATIONS - Companies (portfolio, prospects, LPs)
model Organization {
  id              String   @id @default(cuid())
  canonicalKey    String   @unique // domain or normalized name for deduplication

  // Core attributes
  name            String   @unique
  legalName       String?
  domain          String?
  description     String?  @db.Text
  website         String?
  logoUrl         String?

  // Classification
  organizationType OrganizationType @default(PROSPECT)
  stage           String? // Pre-seed, Seed, Series A, etc. (for portfolio/prospects)
  industry        String? // Vertical (DeFi, Infrastructure, Gaming, etc.)

  // Geography
  city            String?
  country         String?
  region          String?

  // Ownership tracking
  addedBy         String?   // Person ID of team member who added this
  currentOwner    String?   // Person ID of team member who owns relationship
  primaryPOC      String?   // Person ID of primary point of contact

  // Privacy
  privacyTier     PrivacyTier @default(INTERNAL)

  // Metadata
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  // Relationships (use Relationship model for graph edges)
  // Query via: Relationship.where({ sourceType: "Organization", sourceId: org.id })
  //        or: Relationship.where({ targetType: "Organization", targetId: org.id })
  deals           Deal[]
  investments     Investment[]
  lpCommitments   LPCommitment[]
  conversations   Conversation[] @relation("ConversationOrganizations")
  tasks           Task[]
  facts           Fact[]
  metrics         OrganizationMetric[]
  syndicateDeals  SyndicateDeal[]
  fundInvestments FundInvestment[]

  @@index([canonicalKey])
  @@index([organizationType])
  @@index([privacyTier])
  @@index([city])
  @@index([country])
  @@index([region])
  @@index([currentOwner])
}

// GENERIC RELATIONSHIPS - Graph edges between any entities
// This is the core of the graph database approach in Postgres
model Relationship {
  id              String   @id @default(cuid())

  // Source node (from)
  sourceType      String   // "Person", "Organization", "Deal", "Investment"
  sourceId        String

  // Target node (to)
  targetType      String   // "Person", "Organization", "Deal", "Investment"
  targetId        String

  // Relationship type (flexible, not enum - AI can create new types!)
  // Examples: "WORKS_AT", "FOUNDED", "INVESTED_IN", "ADVISED", "INTRODUCED_BY",
  //           "KNOWS", "CO_INVESTED_WITH", "COMPETED_AGAINST", "REFERRED",
  //           "MENTORED", "HIRED", "PARTNERED_WITH", "ACQUIRED_BY", etc.
  relationshipType String

  // Relationship metadata (flexible JSON for any additional context)
  // Examples: { "role": "CEO", "equity": "2%", "title": "Technical Advisor" }
  properties      Json?

  // Relationship strength/confidence (0.0 = weak, 1.0 = strong)
  // AI can use this for graph traversal prioritization
  strength        Decimal  @default(1.0)
  confidence      Decimal  @default(1.0) // How confident are we in this relationship?

  // Temporal validity
  isActive        Boolean  @default(true)
  validFrom       DateTime @default(now())
  validUntil      DateTime? // null = current/ongoing

  // Provenance (who created this relationship and how)
  sourceOfTruth   String   // "manual", "ai_extracted", "email", "fireflies", "linkedin", "crunchbase"
  sourceId_ref    String?  // Reference to source (conversation ID, fact ID, etc.)
  createdBy       String?  // User ID who confirmed this

  // Metadata
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  @@unique([sourceType, sourceId, targetType, targetId, relationshipType, validFrom])
  @@index([sourceType, sourceId])
  @@index([targetType, targetId])
  @@index([relationshipType])
  @@index([isActive])
  @@index([strength])
}

// DEALS - Investment opportunities
model Deal {
  id              String   @id @default(cuid())

  // Core details
  name            String
  organizationId  String
  organization    Organization @relation(fields: [organizationId], references: [id], onDelete: Cascade)

  // Deal specifics
  stage           DealStage @default(SOURCED)
  dealType        DealType  @default(EQUITY)

  // Financials
  askAmount       Decimal?  // Amount they're raising
  ourAllocation   Decimal?  // Amount we plan to invest
  valuation       Decimal?
  valuationType   String?   // "pre", "post", "cap"

  // Timeline
  firstContactDate DateTime?
  expectedCloseDate DateTime?
  actualCloseDate  DateTime?

  // Deal Source & Signal Tracking
  sourceChannel   String?   // "inbound", "outbound", "referral", "syndicate", "accelerator", etc.
  introducedBy    String?   // Person ID who made the intro
  referralSource  String?   // Name of referrer if external
  thesisAlignment String?   // How deal aligns with investment thesis
  passReason      String?   // Reason for passing (if passed)
  competitorDeals String?   // Other funds also looking at the deal

  // Engagement Metrics
  totalMeetings   Int       @default(0)  // Total meeting count
  lastMeetingDate DateTime?
  avgResponseTime Int?      // Average response time in hours

  // Attio Integration
  attioEntryId    String?   // Attio list entry ID
  attioRecordId   String?   // Attio company record ID

  // Metadata
  privacyTier     PrivacyTier @default(SENSITIVE)
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  // Relationships
  conversations   Conversation[] @relation("ConversationDeals")
  tasks           Task[]
  facts           Fact[]
  investment      Investment? // If closed
  stageHistory    DealStageHistory[]

  @@index([organizationId])
  @@index([stage])
  @@index([expectedCloseDate])
  @@index([sourceChannel])
  @@index([attioEntryId])
}

// DEAL STAGE HISTORY - Track stage transitions for analytics
model DealStageHistory {
  id              String    @id @default(cuid())

  dealId          String
  deal            Deal      @relation(fields: [dealId], references: [id], onDelete: Cascade)

  // Stage transition
  fromStage       DealStage?
  toStage         DealStage
  transitionDate  DateTime  @default(now())

  // Context
  daysInPreviousStage Int?   // How long was it in the previous stage
  triggeredBy     String?   // What triggered the transition (meeting, email, review)
  notes           String?   @db.Text

  // Metadata
  createdAt       DateTime  @default(now())
  createdBy       String?   // User who made the change

  @@index([dealId, transitionDate])
  @@index([toStage])
}

// INVESTMENTS - Closed deals / portfolio companies
model Investment {
  id              String   @id @default(cuid())

  // Link to deal (optional - some may be imported without deal history)
  dealId          String?  @unique
  deal            Deal?    @relation(fields: [dealId], references: [id])

  organizationId  String
  organization    Organization @relation(fields: [organizationId], references: [id], onDelete: Cascade)

  // Investment details
  investmentDate  DateTime
  amountInvested  Decimal
  instrumentType  String   // "SAFE", "Equity", "Convertible", "Token"
  ownership       Decimal? // % ownership (if applicable)
  valuation       Decimal?

  // Current status
  status          InvestmentStatus @default(ACTIVE)
  currentValue    Decimal?
  exitDate        DateTime?
  exitMultiple    Decimal?

  // Metadata
  privacyTier     PrivacyTier @default(HIGHLY_SENSITIVE)
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  // Relationships
  metrics         InvestmentMetric[]

  @@index([organizationId])
  @@index([status])
  @@index([investmentDate])
}

// LPs - Limited Partner commitments
model LPCommitment {
  id              String   @id @default(cuid())

  // Who (can be Person or Organization)
  personId        String?
  person          Person?  @relation(fields: [personId], references: [id])
  organizationId  String?
  organization    Organization? @relation(fields: [organizationId], references: [id])

  // Commitment details
  fundName        String   // Which RBV fund
  commitmentAmount Decimal
  calledAmount    Decimal  @default(0)
  distributedAmount Decimal @default(0)
  commitmentDate  DateTime

  // Status
  status          String   @default("active") // active, fulfilled, defaulted

  // Metadata
  privacyTier     PrivacyTier @default(HIGHLY_SENSITIVE)
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  @@index([personId])
  @@index([organizationId])
  @@index([fundName])
}

// CONVERSATIONS - Meetings, emails, calls
model Conversation {
  id              String   @id @default(cuid())

  // What happened
  title           String
  summary         String?  @db.Text
  transcript      String?  @db.Text // From Fireflies
  medium          ConversationMedium @default(MEETING)

  // When
  conversationDate DateTime
  duration        Int?     // Minutes

  // Who
  participants    Person[] @relation("ConversationParticipants")
  organizations   Organization[] @relation("ConversationOrganizations")
  deals           Deal[] @relation("ConversationDeals")

  // Source
  sourceType      String   // "fireflies", "email", "manual", "imported"
  sourceId        String?  // External ID from source system
  sourceUrl       String?

  // Metadata
  privacyTier     PrivacyTier @default(INTERNAL)
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  // AI-extracted facts
  facts           Fact[]
  tasks           Task[]

  @@index([conversationDate])
  @@index([sourceType, sourceId])
}

// TASKS - Action items and follow-ups
model Task {
  id              String   @id @default(cuid())

  // Task details
  title           String
  description     String?  @db.Text
  status          TaskStatus @default(OPEN)
  priority        Priority @default(MEDIUM)

  // Assignments
  assignedToPerson Person? @relation(fields: [assignedToPersonId], references: [id])
  assignedToPersonId String?

  // Context
  relatedOrganization Organization? @relation(fields: [relatedOrganizationId], references: [id])
  relatedOrganizationId String?
  relatedDeal     Deal?    @relation(fields: [relatedDealId], references: [id])
  relatedDealId   String?
  sourceConversation Conversation? @relation(fields: [sourceConversationId], references: [id])
  sourceConversationId String?

  // Timing
  dueDate         DateTime?
  completedAt     DateTime?

  // Metadata
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  @@index([status])
  @@index([dueDate])
  @@index([assignedToPersonId])
}

// FACTS - Atomic knowledge units with provenance
model Fact {
  id              String   @id @default(cuid())

  // What entity this fact is about
  personId        String?
  person          Person?  @relation(fields: [personId], references: [id], onDelete: Cascade)
  organizationId  String?
  organization    Organization? @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  dealId          String?
  deal            Deal?    @relation(fields: [dealId], references: [id], onDelete: Cascade)
  conversationId  String?
  conversation    Conversation? @relation(fields: [conversationId], references: [id])

  // The fact itself
  factType        String   // "metric", "note", "risk", "opportunity", "relationship", etc.
  key             String   // "MRR", "team_size", "burn_rate", "notes", etc.
  value           String   @db.Text // JSON or text value

  // Provenance (CRITICAL for trust)
  sourceType      String   // "fireflies", "email", "enrichment_api", "manual", "ai_extracted"
  sourceId        String?  // External ID
  sourceUrl       String?
  confidence      Decimal  @default(1.0) // 0.0-1.0 for AI-extracted facts

  // Versioning
  validFrom       DateTime @default(now())
  validUntil      DateTime? // null = current
  replacedByFact  String?  // ID of fact that superseded this one

  // Metadata
  createdAt       DateTime @default(now())
  createdBy       String?  // User ID who created/confirmed this

  @@index([personId, factType, key])
  @@index([organizationId, factType, key])
  @@index([dealId, factType, key])
  @@index([sourceType, sourceId])
  @@index([validFrom, validUntil])
}

// TIME-SERIES METRICS - For tracking organization performance
model OrganizationMetric {
  id              String   @id @default(cuid())

  organizationId  String
  organization    Organization @relation(fields: [organizationId], references: [id], onDelete: Cascade)

  // The metric
  metricType      String   // "MRR", "ARR", "burn_rate", "runway", "team_size", etc.
  value           Decimal
  unit            String?  // "USD", "months", "people", etc.

  // Time
  snapshotDate    DateTime // When this metric was measured

  // Provenance
  sourceType      String
  sourceId        String?
  confidence      Decimal  @default(1.0)

  // Metadata
  createdAt       DateTime @default(now())

  @@unique([organizationId, metricType, snapshotDate])
  @@index([organizationId, metricType, snapshotDate])
}

// TIME-SERIES METRICS - For tracking investment performance
model InvestmentMetric {
  id              String   @id @default(cuid())

  investmentId    String
  investment      Investment @relation(fields: [investmentId], references: [id], onDelete: Cascade)

  // The metric
  metricType      String   // "valuation", "ownership_diluted", "current_value", etc.
  value           Decimal
  unit            String?  // "USD", "percent", etc.

  // Time
  snapshotDate    DateTime // When this metric was measured

  // Provenance
  sourceType      String
  sourceId        String?
  confidence      Decimal  @default(1.0)

  // Metadata
  createdAt       DateTime @default(now())

  @@unique([investmentId, metricType, snapshotDate])
  @@index([investmentId, metricType, snapshotDate])
}

// ============================================================================
// ANGELLIST SYNDICATE PORTFOLIO
// ============================================================================

// Syndicate deal status
enum SyndicateDealStatus {
  LIVE
  REALIZED
  CLOSING
  TRANSFERRED
}

// Syndicate deal type
enum SyndicateDealType {
  SYNDICATE
  FUND
}

// SYNDICATE DEALS - AngelList syndicate investments
model SyndicateDeal {
  id                  String   @id @default(cuid())

  // Company Info
  companyName         String
  companyDomain       String?  // For news lookups
  market              String?  // Blockchain/Crypto, AI/ML, SaaS, etc.

  // Deal Classification
  status              SyndicateDealStatus @default(LIVE)
  dealType            SyndicateDealType   @default(SYNDICATE)
  isHostedDeal        Boolean  @default(false) // true if Red Beard Ventures is lead (0% carry)

  // Investment Details
  investDate          DateTime?
  invested            Decimal  @db.Decimal(15, 2)
  unrealizedValue     Decimal? @db.Decimal(15, 2)
  realizedValue       Decimal? @db.Decimal(15, 2)
  netValue            Decimal? @db.Decimal(15, 2)
  multiple            Decimal? @db.Decimal(10, 4)

  // Share Details
  numberOfShares      Decimal? @db.Decimal(15, 2)
  paidPricePerShare   Decimal? @db.Decimal(15, 6)
  currentPricePerShare Decimal? @db.Decimal(15, 6)
  numberOfLPs         Int?

  // Entity & Structure
  investmentEntity    String   // Drew Austin Greenfeld, DrewsVentures Holdings LLC, etc.
  leadSyndicate       String?  // Red Beard Ventures, Andreas Klinger, etc.
  fundName            String?  // SPV name / Fund Legal Name

  // Round Info
  round               String?  // Pre-Seed, Seed, Series A, etc.
  instrument          String?  // SAFE, Equity Round, Convertible Debt, SAFT
  roundSize           Decimal? @db.Decimal(15, 2)
  allocation          Decimal? @db.Decimal(15, 2)
  valuationType       String?  // Pre-money, Post-money, cap
  valuation           Decimal? @db.Decimal(15, 2)
  valuationUpdatedAt  DateTime?
  discount            Decimal? @db.Decimal(5, 2)
  carry               Decimal? @db.Decimal(5, 2)
  shareClass          String?  // Common, Preferred
  proRataRights       Boolean? // Pro Rata Rights

  // Linked Organization (optional - for deeper integration)
  organizationId      String?
  organization        Organization? @relation(fields: [organizationId], references: [id])

  // News/Updates
  lastNewsCheck       DateTime?

  createdAt           DateTime @default(now())
  updatedAt           DateTime @updatedAt

  @@index([status])
  @@index([isHostedDeal])
  @@index([market])
  @@index([companyName])
}

// ============================================================================
// RBV FUND I PORTFOLIO
// ============================================================================

// Fund investment type
enum FundInvestmentType {
  TOKEN_SAFT      // Token/SAFT investments
  EQUITY          // Equity positions
  TPA             // Token Purchase Agreements
  WARRANT         // Token warrants
}

// Fund investment status
enum FundInvestmentStatus {
  ACTIVE          // Currently held
  PARTIALLY_REALIZED  // Some tokens/equity sold
  FULLY_REALIZED  // Completely exited
  WRITTEN_OFF     // Written off
}

// FUND INVESTMENTS - RBV Fund I portfolio positions
model FundInvestment {
  id                  String   @id @default(cuid())

  // Fund Info
  fundName            String   @default("Red Beard Ventures Fund I LP")

  // Company Info
  companyName         String
  nickname            String?  // Short name or token ticker

  // Investment Classification
  investmentType      FundInvestmentType @default(TOKEN_SAFT)
  status              FundInvestmentStatus @default(ACTIVE)
  sector              String?  // AI, DeFi, Gaming, Infrastructure, SocialFi, DePIN, Consumer

  // Investment Details
  amountInvested      Decimal  @db.Decimal(15, 2)
  investmentDate      DateTime?

  // Token Details (for TOKEN_SAFT, TPA, WARRANT)
  tokenName           String?  // OORT, SAGA, LMWR, etc.
  tokenQuantity       Decimal? @db.Decimal(20, 4)  // Number of tokens
  currentPrice        Decimal? @db.Decimal(15, 8)  // Current token price
  tokenValue          Decimal? @db.Decimal(15, 2)  // tokenQuantity * currentPrice

  // Equity Details (for EQUITY)
  equityValue         Decimal? @db.Decimal(15, 2)  // Current equity valuation
  ownershipPercent    Decimal? @db.Decimal(10, 6)

  // Combined Value
  totalValue          Decimal? @db.Decimal(15, 2)  // tokenValue + equityValue

  // Vesting Schedule (for tokens)
  launchDate          DateTime?
  cliffMonths         Int?     // Cliff period in months
  initialReleasePercent Decimal? @db.Decimal(5, 2)  // % released at cliff
  vestingPeriodicity  String?  // monthly, daily, quarterly
  vestingPeriods      Int?     // Number of vesting periods
  vestingEndDate      DateTime?

  // Liquidity Status
  isLiquid            Boolean  @default(false)  // Is token live/tradeable?
  liquidBalance       Decimal? @db.Decimal(15, 2)  // Value of liquid/available tokens
  lockedBalance       Decimal? @db.Decimal(15, 2)  // Value of locked/vesting tokens
  stakedTokens        Decimal? @db.Decimal(20, 4)  // Tokens currently staked

  // Realized Gains
  tokensRealized      Decimal? @db.Decimal(20, 4)  // Tokens sold
  realizedValue       Decimal? @db.Decimal(15, 2)  // Cash received from sales
  realizedPercent     Decimal? @db.Decimal(5, 2)   // % of position realized

  // Linked Organization (optional)
  organizationId      String?
  organization        Organization? @relation(fields: [organizationId], references: [id])

  // Notes
  notes               String?  @db.Text
  attioNotes          String?  @db.Text  // Notes from Attio

  // Metadata
  lastPriceUpdate     DateTime?
  createdAt           DateTime @default(now())
  updatedAt           DateTime @updatedAt

  // Related records
  tokenSales          FundTokenSale[]
  snapshots           FundInvestmentSnapshot[]

  @@index([fundName])
  @@index([companyName])
  @@index([investmentType])
  @@index([status])
  @@index([sector])
  @@index([isLiquid])
  @@index([organizationId])
}

// FUND TOKEN SALES - Track individual token sale transactions
model FundTokenSale {
  id                  String   @id @default(cuid())

  fundInvestmentId    String
  fundInvestment      FundInvestment @relation(fields: [fundInvestmentId], references: [id], onDelete: Cascade)

  // Sale Details
  saleDate            DateTime
  tokensSold          Decimal  @db.Decimal(20, 4)
  pricePerToken       Decimal  @db.Decimal(15, 8)
  totalProceeds       Decimal  @db.Decimal(15, 2)

  // Notes
  notes               String?

  createdAt           DateTime @default(now())

  @@index([fundInvestmentId, saleDate])
}

// FUND INVESTMENT SNAPSHOTS - Monthly/periodic valuations
model FundInvestmentSnapshot {
  id                  String   @id @default(cuid())

  fundInvestmentId    String
  fundInvestment      FundInvestment @relation(fields: [fundInvestmentId], references: [id], onDelete: Cascade)

  // Snapshot Date
  snapshotDate        DateTime

  // Values at snapshot
  tokenPrice          Decimal? @db.Decimal(15, 8)
  tokenValue          Decimal? @db.Decimal(15, 2)
  equityValue         Decimal? @db.Decimal(15, 2)
  totalValue          Decimal? @db.Decimal(15, 2)
  liquidBalance       Decimal? @db.Decimal(15, 2)

  createdAt           DateTime @default(now())

  @@unique([fundInvestmentId, snapshotDate])
  @@index([snapshotDate])
}

// FUND METRICS - Overall fund performance tracking
model FundMetric {
  id                  String   @id @default(cuid())

  fundName            String   @default("Red Beard Ventures Fund I LP")
  snapshotDate        DateTime

  // Fund Size & Deployment
  totalCommitted      Decimal? @db.Decimal(15, 2)  // Total LP commitments
  totalCalled         Decimal? @db.Decimal(15, 2)  // Capital called
  totalInvested       Decimal? @db.Decimal(15, 2)  // Capital deployed
  reservesRemaining   Decimal? @db.Decimal(15, 2)  // Dry powder

  // Portfolio Value
  tokenValue          Decimal? @db.Decimal(15, 2)  // Total token holdings value
  equityValue         Decimal? @db.Decimal(15, 2)  // Total equity holdings value
  totalPortfolioValue Decimal? @db.Decimal(15, 2)  // Combined NAV

  // Liquidity
  liquidBalance       Decimal? @db.Decimal(15, 2)  // Liquid/available value
  nonLiquidBalance    Decimal? @db.Decimal(15, 2)  // Locked/vesting value
  liquidPercent       Decimal? @db.Decimal(5, 2)

  // Realizations
  totalRealized       Decimal? @db.Decimal(15, 2)  // Cash from token sales
  totalDistributed    Decimal? @db.Decimal(15, 2)  // Distributions to LPs
  recycledCapital     Decimal? @db.Decimal(15, 2)  // Reinvested proceeds

  // Performance Metrics
  tvpiMultiple        Decimal? @db.Decimal(10, 4)  // (NAV + Distributed) / Called
  dpiMultiple         Decimal? @db.Decimal(10, 4)  // Distributed / Called
  rvpiMultiple        Decimal? @db.Decimal(10, 4)  // NAV / Called
  irr                 Decimal? @db.Decimal(10, 4)  // Internal Rate of Return

  // Portfolio Stats
  totalInvestments    Int?     // Number of portfolio companies
  tokensLive          Int?     // Number of tokens that are live/tradeable
  tokensStaked        Int?     // Number of positions with staked tokens

  createdAt           DateTime @default(now())

  @@unique([fundName, snapshotDate])
  @@index([fundName, snapshotDate])
}

// ============================================================================
// GRAPH DATABASE PATTERN - Relationship Examples
// ============================================================================
//
// The Relationship model enables a flexible, evolving knowledge graph.
// The AI agent can identify and create new relationship types organically.
//
// COMMON RELATIONSHIP TYPES (examples, not exhaustive):
//
// Person → Organization:
//   - WORKS_AT (properties: { role: "CEO", startDate: "2024-01-01" })
//   - FOUNDED (properties: { cofounderCount: 3, equityPercent: 25 })
//   - ADVISED (properties: { title: "Technical Advisor", compensationType: "equity" })
//   - INVESTED_IN (properties: { checkSize: 50000, round: "seed" })
//
// Person → Person:
//   - KNOWS (properties: { context: "college roommates", strength: 0.9 })
//   - INTRODUCED_BY (properties: { introducerName: "Alice", date: "2024-03-15" })
//   - MENTORED (properties: { duration: "2 years" })
//   - WORKED_WITH (properties: { company: "Acme Corp", years: 3 })
//
// Organization → Organization:
//   - PARTNERED_WITH (properties: { partnershipType: "integration", startDate: "2024-01-01" })
//   - ACQUIRED_BY (properties: { acquisitionDate: "2025-06-01", amount: 50000000 })
//   - COMPETED_AGAINST (properties: { vertical: "DeFi", intensity: 0.8 })
//   - SPUN_OUT_FROM (properties: { spinoutDate: "2023-05-01" })
//
// Organization → Deal:
//   - PREVIOUS_INVESTOR_IN (properties: { round: "Series A", leadInvestor: false })
//   - COMPETING_BID (properties: { theirValuation: 100000000 })
//
// Deal → Deal:
//   - FOLLOW_ON_FROM (properties: { previousRound: "Seed", monthsBetween: 18 })
//   - COMPETING_DEAL (properties: { sameMarket: true })
//
// QUERYING EXAMPLES:
//
// 1. Find all people who work at an organization:
//    Relationship.findMany({
//      where: {
//        targetType: "Organization",
//        targetId: orgId,
//        relationshipType: "WORKS_AT",
//        isActive: true
//      }
//    })
//
// 2. Find warm intro paths (Person → Person → Organization):
//    - Get all people user KNOWS
//    - For each, get who they WORK_AT or FOUNDED
//    - Return paths with relationship strength scores
//
// 3. Find co-investment network:
//    - Get all Person who INVESTED_IN same Deal
//    - Create CO_INVESTED_WITH relationships
//    - Build investor syndicate graph
//
// 4. AI-driven relationship discovery:
//    - Parse conversation: "Sarah introduced me to John at Acme Corp"
//    - AI extracts:
//      * Person(Sarah) -INTRODUCED-> Person(User)
//      * Person(John) -WORKS_AT-> Organization(Acme Corp)
//      * Creates sourceOfTruth: "ai_extracted", sourceId: conversationId
//
// ============================================================================
